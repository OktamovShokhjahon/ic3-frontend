(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{4721:function(e,s,t){Promise.resolve().then(t.bind(t,679))},679:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return c}});var a=t(7437),l=t(2265),r=t(4033),i=t(8222);function c(){var e,s,t,c;let[n,o]=(0,l.useState)(null),[x,u]=(0,l.useState)([]),[m,h]=(0,l.useState)(null),[g,p]=(0,l.useState)(!0),[v,b]=(0,l.useState)("dashboard"),[y,j]=(0,l.useState)(!1),[f,N]=(0,l.useState)(null),w=(0,r.useRouter)();(0,l.useEffect)(()=>{k(),"users"===v?A():("stats"===v||"dashboard"===v)&&C()},[v]);let k=async()=>{try{let e=await i.Z.get("/auth/me");if("admin"!==e.data.user.role){w.push("/dashboard");return}o(e.data.user)}catch(e){w.push("/login")}finally{p(!1)}},A=async()=>{try{let e=await i.Z.get("/admin/users");u(e.data.users)}catch(e){console.error("Failed to fetch users:",e)}},C=async()=>{try{let e=await i.Z.get("/admin/stats");h(e.data)}catch(e){console.error("Failed to fetch stats:",e)}},S=async e=>{try{await i.Z.post("/admin/users",e),j(!1),A()}catch(e){console.error("Failed to create user:",e)}},U=async(e,s)=>{try{await i.Z.put("/admin/users/".concat(e),s),N(null),A()}catch(e){console.error("Failed to update user:",e)}},D=async e=>{if(confirm("Are you sure you want to delete this user?"))try{await i.Z.delete("/admin/users/".concat(e)),A()}catch(e){console.error("Failed to delete user:",e)}},_=async e=>{try{await i.Z.post("/admin/users/".concat(e,"/reset-device"),{}),A()}catch(e){console.error("Failed to reset device:",e)}},T=async e=>{try{await i.Z.put("/admin/users/".concat(e._id),{isActive:!e.isActive}),A(),"dashboard"===v&&C()}catch(e){console.error("Failed to toggle user active status:",e)}},Z=async(e,s)=>{try{await i.Z.put("/admin/users/".concat(e._id,"/level-access"),{[s]:!e.levelAccess[s]}),A()}catch(e){console.error("Failed to update level access:",e)}},L=async()=>{try{await i.Z.post("/auth/logout",{}),w.push("/login")}catch(e){console.error("Logout failed:",e)}};return g?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-white",children:"Loading..."})}):n?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Admin Panel"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-gray-700",children:["Admin: ",n.username]}),(0,a.jsx)("button",{onClick:()=>w.push("/dashboard"),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition",children:"Dashboard"}),(0,a.jsx)("button",{onClick:L,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition",children:"Logout"})]})]})})}),(0,a.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"flex space-x-8",children:[{id:"dashboard",label:"Dashboard"},{id:"users",label:"User Management"},{id:"stats",label:"Statistics"}].map(e=>(0,a.jsx)("button",{onClick:()=>b(e.id),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat(v===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:["dashboard"===v&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:null!==(s=null==m?void 0:m.totalUsers)&&void 0!==s?s:"—"}),(0,a.jsx)("div",{className:"text-gray-600",children:"Total Users"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:null!==(t=null==m?void 0:m.activeUsers)&&void 0!==t?t:"—"}),(0,a.jsx)("div",{className:"text-gray-600",children:"Active Users"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:null!==(c=null==m?void 0:m.totalTests)&&void 0!==c?c:"—"}),(0,a.jsx)("div",{className:"text-gray-600",children:"Total Tests"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:m?"".concat(Math.round(m.averageScore),"%"):"—"}),(0,a.jsx)("div",{className:"text-gray-600",children:"Average Score"})]})]}),"users"===v&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"User Management"}),(0,a.jsx)("button",{onClick:()=>j(!0),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition",children:"Create User"})]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Username"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Level Access"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Device"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.username}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("admin"===e.role?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"),children:e.role})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsx)("div",{className:"flex space-x-2",children:["level1","level2","level3"].map((s,t)=>{let l=e.levelAccess[s];return(0,a.jsx)("button",{onClick:()=>Z(e,s),className:"px-2 py-1 text-xs rounded transition ".concat(l?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-800 hover:bg-gray-200"),title:"Toggle level access",type:"button",children:"L".concat(t+1)},s)})})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.deviceId?"\uD83D\uDFE2 Active":"\uD83D\uDD34 None"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>N(e),className:"text-blue-600 hover:text-blue-900",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>T(e),className:"text-orange-600 hover:text-orange-900",title:e.isActive?"Disable user":"Enable user",children:e.isActive?"Disable":"Enable"}),e.deviceId&&(0,a.jsx)("button",{onClick:()=>_(e._id),className:"text-yellow-600 hover:text-yellow-900",children:"Reset"}),(0,a.jsx)("button",{onClick:()=>D(e._id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})})]},e._id))})]})})]}),"stats"===v&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Platform Statistics"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:(null==m?void 0:m.totalUsers)||0}),(0,a.jsx)("div",{className:"text-gray-600",children:"Total Users"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-green-600",children:(null==m?void 0:m.activeUsers)||0}),(0,a.jsx)("div",{className:"text-gray-600",children:"Active Users"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-purple-600",children:(null==m?void 0:m.totalTests)||0}),(0,a.jsx)("div",{className:"text-gray-600",children:"Total Tests"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-orange-600",children:[Math.round((null==m?void 0:m.averageScore)||0),"%"]}),(0,a.jsx)("div",{className:"text-gray-600",children:"Average Score"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Recent Test Results"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Level"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Score"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:null==m?void 0:null===(e=m.recentTests)||void 0===e?void 0:e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.userId.username}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["Level ",e.level]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.type}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsxs)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.score>=80?"bg-green-100 text-green-800":e.score>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[e.score,"%"]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()})]},e._id))})]})})]})]})]}),(y||f)&&(0,a.jsx)(d,{user:f,onClose:()=>{j(!1),N(null)},onSubmit:f?e=>U(f._id,e):S})]}):null}function d(e){var s;let{user:t,onClose:r,onSubmit:i}=e,[c,d]=(0,l.useState)({username:(null==t?void 0:t.username)||"",password:"",role:(null==t?void 0:t.role)||"user",isActive:null===(s=null==t?void 0:t.isActive)||void 0===s||s,levelAccess:(null==t?void 0:t.levelAccess)||{level1:!1,level2:!1,level3:!1}});return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t?"Edit User":"Create User"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),i(c)},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,a.jsx)("input",{type:"text",value:c.username,onChange:e=>d({...c,username:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),!t&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",value:c.password,onChange:e=>d({...c,password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,a.jsxs)("select",{value:c.role,onChange:e=>d({...c,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"user",children:"User"}),(0,a.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,a.jsxs)("select",{value:c.isActive.toString(),onChange:e=>d({...c,isActive:"true"===e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"true",children:"Active"}),(0,a.jsx)("option",{value:"false",children:"Inactive"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Level Access"}),(0,a.jsx)("div",{className:"space-y-2",children:["level1","level2","level3"].map(e=>(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:c.levelAccess[e],onChange:s=>d({...c,levelAccess:{...c.levelAccess,[e]:s.target.checked}}),className:"mr-2"}),e.charAt(0).toUpperCase()+e.slice(1)]},e))})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:t?"Update":"Create"})]})]})]})})}},8222:function(e,s,t){"use strict";let a=t(4829).Z.create({baseURL:"http://77.83.206.105:5000/api",withCredentials:!0});a.interceptors.request.use(e=>{{let t=localStorage.getItem("deviceId");if(t){var s;e.headers=null!==(s=e.headers)&&void 0!==s?s:{},e.headers["x-device-id"]=t}}return e}),s.Z=a}},function(e){e.O(0,[600,971,938,744],function(){return e(e.s=4721)}),_N_E=e.O()}]);